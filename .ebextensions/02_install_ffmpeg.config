packages:
  yum:
    ffmpeg: []
    ffmpeg-devel: []

commands:
  01_enable_epel:
    command: "amazon-linux-extras install epel -y"
    ignoreErrors: true
  02_install_ffmpeg:
    command: "yum install -y ffmpeg ffmpeg-devel"
    ignoreErrors: true
  03_verify_ffmpeg:
    command: "which ffmpeg || echo 'ffmpeg not found, trying alternative installation'"
    ignoreErrors: true
  04_install_ffmpeg_alternative:
    command: |
      if ! which ffmpeg; then
        cd /tmp
        wget https://johnvansickle.com/ffmpeg/releases/ffmpeg-release-amd64-static.tar.xz
        tar xf ffmpeg-release-amd64-static.tar.xz
        cp ffmpeg-*-amd64-static/ffmpeg /usr/local/bin/
        cp ffmpeg-*-amd64-static/ffprobe /usr/local/bin/
        chmod +x /usr/local/bin/ffmpeg /usr/local/bin/ffprobe
        ln -sf /usr/local/bin/ffmpeg /usr/bin/ffmpeg
        ln -sf /usr/local/bin/ffprobe /usr/bin/ffprobe
      fi
    ignoreErrors: true
